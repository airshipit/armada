# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

- project:
    templates:
      - openstack-cover-jobs
      - docs-on-readthedocs
    vars:
      rtd_webhook_id: '47578'
      rtd_project_name: 'airship-armada'
    check:
      jobs:
        - openstack-tox-py312
        # - openstack-tox-docs
        - openstack-tox-pep8
        - armada-chart-build-gate
        - armada-chart-build-latest-htk
        - armada-docker-build-gate-ubuntu_noble
        - armada-airskiff-deployment-noble-kubeadm

    gate:
      jobs:
        - openstack-tox-py311
        # - openstack-tox-docs
        - openstack-tox-pep8
        - armada-chart-build-gate
        - armada-docker-build-gate-ubuntu_noble

    post:
      jobs:
        - armada-docker-publish-ubuntu_noble
        - armada-upload-git-mirror

    promote:
      jobs:
        - promote-airship-project-docs

- nodeset:
    name: armada-single-node-jammy
    nodes:
      - name: primary
        label: ubuntu-jammy

- nodeset:
    name: armada-single-node-noble
    nodes:
      - name: primary
        label: ubuntu-noble

- job:
    name: armada-chart-build-gate
    description: |
      Builds charts using pinned Helm toolkit.
    timeout: 900
    run: tools/gate/playbooks/build-charts.yaml
    nodeset: armada-single-node-noble
    vars:
      HTK_COMMIT: 80041dfbb5c22aa67dcd8dfa3332a943aa0d366c


- job:
    name: armada-chart-build-latest-htk
    description: |
      Builds charts using latest Helm toolkit.
    timeout: 900
    voting: true
    run: tools/gate/playbooks/build-charts.yaml
    nodeset: armada-single-node-noble
    vars:
      HTK_COMMIT: master

- job:
    name: armada-docker-build-gate-ubuntu_noble
    timeout: 3600
    run: tools/gate/playbooks/docker-image-build.yaml
    nodeset: armada-single-node-noble
    vars:
      publish: false
      distro: ubuntu_noble
      tags:
        dynamic:
          patch_set: true

- job:
    name: armada-airskiff-deployment-noble-kubeadm
    description: |
      Deploy Memcached using Airskiff and submitted Armada changes.
    parent: treasuremap-airskiff-infra-deploy-base
    nodeset: treasuremap-airskiff-1node-ubuntu_noble
    required-projects:
      - name: airship/treasuremap
        override-checkout: v1.9
    vars:
      treasuremap_ref: v1.9
      CLONE_ARMADA: false
      MAKE_ARMADA_IMAGES: true
      USE_ARMADA_GO: false
      DISTRO: ubuntu_noble
      DOCKER_REGISTRY: localhost:5000
      gate_scripts_relative_path: ../../airship/treasuremap

- job:
    name: armada-docker-publish-ubuntu_noble
    timeout: 3600
    voting: true
    run: tools/gate/playbooks/docker-image-build.yaml
    nodeset: armada-single-node-noble
    secrets:
      - airship_armada_quay_creds_2026
    vars:
      publish: true
      distro: ubuntu_noble
      tags:
        dynamic:
          branch: true
          commit: true
        static:
          - latest
          - airflow_3.1.5

- secret:
    name: airship_armada_quay_creds_2026
    data:
      username: !encrypted/pkcs1-oaep
        - xUkpHMBJobtoYWE8hRDc3r/nsgwbS9BccMVxZTEK8wiZsvGDU8V8nT6fQjnlO9P/yIraZ
          y3Tlnhf37fZo+OMaodFgtgf24c3l8GfVhwR3gnwHi25eLadPzbF0/lPK15/YdjNO1r0fC
          CsAzmUiKGJXqE231jzbtUQXr/JYbiwHzO7dbqQNCxqiFiUyv7zGK9LNM1fnfTZFCUM6B3
          x6t8aUNe4PLXNzWzFzt7H/IZRdwIrfFZAY3KE2hvD+k2AsgSiCv3AikjPEUY16XsylGrJ
          e5aUZXxPlsGBGvzJlmLupRn8zHAiuQeQEBnCAVmHPZmAcncPCdi8fxiBZ3Y0Gegd80OWk
          QoxvVIJhlWXpcYwptlzWjiLGILusgL0/+e/2q5/uz2IF4g8Tzwd5nz5MozdPfnKUU/e2F
          E5lCnf/sh++AUn+imCwhQs9QZa/qs40CUTlQdiUjROjfiYLnxuZB2t3MPsCa3GYogINqm
          w01gc2N9b5t9wiofoumb8P7qzGrEIa2H0rtjQV55ug+iL91cNObw3FTZsBVeFOGcxU1GF
          gMHnRcFKw8/bJfEXsqKD7V6FsrHM5vDJ3iz8J7C60/MJT3O7tphtuXWSOio9snm+CaFV7
          +BAb4wagUh20RlbsFhunpI4lTA2mgifpwX0mf1WwvPF9FrAhJ3dHrpoOb6c3ZM=
      password: !encrypted/pkcs1-oaep
        - LHZw0IgmY143O3jOXEf+SPLoEQsF39BQhfa5ZuR7Yz8kIP1KAgUOpAGtCcVCyUIVsPTVq
          M7nJ0TMaUdKjkTLaXJan0Sgu7EkX/IkWThG27J8Fk2a3Sds3zpcWNSEIYHkQ4MoIQqJiV
          xSkHlY1R4MRJSvrofCOsiR5qnRJeSqZ4wzWVi2ppg4lKSk1GADBByHkaeVQMhdQj3Uaq1
          XpGLs/sEGqno5vCktk8/zl2NnePU5N43Ssmb4ThxRleUXiZ50XK8zIur7qOWPug7oHdWo
          HbzdnpMQ4LyE0X2s8M1elETSogyaoRbDTaUInTO/pFEhBRlzJaA1KJ39h4CKezN5k7fVj
          2VaHTCG/7tP21N0QbaFZgBsnbEaAOKQGId0rXAk6tdWQyp3oVgw4yAAMbPkFUyWa/YZhY
          +voS2Soc5W6XzlGWdIx3On/Gyi89TZaqpzdgSqouiWG4Y6X0YaASiz7OIoroOPUdseCdV
          48PLOpQFfGmHHHR0Q6EZVLRVPNp8CIx2NVqtfptOJ4XQL+1FHdQJ/53JDm34CRDolF3if
          Riya0WK4MxRkYTbnqAPIGOQ8Ag35jNqcV9wQdUZfR/BZPpd/ysB88wJbE5xbB89T1h7vI
          K2GDAlbd3EYj5kaVYr67W1Gy7XebSTkAvwSD2Si0OdidkfnbQrfHBc6GNCzH0s=

- job:
    name: armada-upload-git-mirror
    parent: upload-git-mirror
    description: Mirrors airship/armada to airshipit/armada
    vars:
      git_mirror_repository: airshipit/armada
    secrets:
      - name: git_mirror_credentials
        secret: armada-airshipit-github-ed25519-secret-2026-01-13
        pass-to-parent: true

- secret:
    name: armada-airshipit-github-ed25519-secret-2026-01-13
    data:
      user: git
      host: github.com
      host_key: github.com ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOMqqnkVzrm0SdG6UOoqKLsabgH5C9okWi0dh2l9GKJl
      ssh_key: !encrypted/pkcs1-oaep
        - Uq0TGnghBh3S2ybFki/6gQI4gXBYNYFYctUrcZjM3qq7y0g6qOV9Lxh0jRfVAgfdij1h5
          9Mm1DcLZjJ277pkR4wscM/URtWDjmT9Ny2GtfuqX6YnYvuDD5kaYfXrrgBq2Yi0hiRu/v
          lAu4Qsn3kDDprx9dCi978wNa4jB6jXL4X6SP6kw8wp/+oMxkeiBtOBa41K1FbPIjuE/uY
          Y/D1FFQkyx3ql0rovovY51BKAby5d+sBJAkf4Nar+rliVWgDpKwkDOEvveO2Ly2xamlKy
          rajRDFnGQuGmXtX9uSH/02K9VgrQsZ2G2QIxNV+w7VGQNTM/Px2vwFZvfI3GFyF/sbLvL
          Uupp2lQTKh/UG3U+FvXj48k+grX7xrYNuduMvFbwx/EAu/6Jw9cBKaYgPPc2DyaxC5oBM
          UDbwEJH0AFR7rVYGvfhbSbP6GociYGXtO1OwBxzKf7fdvrO6tbwT7r0TvZIq6SxSjtJJx
          M6M/b9uKogRn90v1b0V8ut+BRjQfRkov5ILK2hoOGNJPVq1WtqmLuxsQtb8BIzl02E8te
          V4nh7czO699XpKRyQoqP3eJiNvxLKX0vHVGubcmOPvu1yE5f1kJAPjt7C9ximI+XHBqmd
          z6z1uga8DmbIC0JDsHjaUkerPU2RzUiQ+ff7lkBW5aCxE6vJyRpTZOHUSvuLBk=
